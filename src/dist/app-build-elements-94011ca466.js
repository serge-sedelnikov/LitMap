"bundle";!function(){var a=System.amdDefine;a("elements/adminMarkerInfo.html!github:systemjs/plugin-text@0.0.4.js",[],function(){return'<template> <div class="section section-fixed float" style="margin-left:8px;margin-right:8px;min-height:300px"> <div class="mini-map" id="mini-map-${index}" ref="miniMap"></div> <div if.bind="data" innerHTML.bind="data" class="text-left"></div> <div if.bind="!data" class="spinner yellow" style="margin-top:30px"> <div class="rect1"></div> <div class="rect2"></div> <div class="rect3"></div> <div class="rect4"></div> <div class="rect5"></div> </div> <div class="text-right"> <a href="JavaScript:void(0);" click.delegate="editMarker()" class="btn btn-default"> <i class="fa fa-gear"></i>&nbsp;<span t="admin.item.edit"></span> </a> <a href="/#/${item.data}" target="_blank" class="btn btn-default"> <i class="fa fa-eye"></i>&nbsp;<span t="admin.item.preview"></span> </a> </div> </div> <template></template></template>'})}(),System.register("elements/adminMarkerInfo.js",["aurelia-framework","fetch","aurelia-fetch-client","../elements/mediaAdjuster","remarkable","aurelia-event-aggregator"],function(a){"use strict";var b,c,d,e,f,g,h;return{setters:[function(a){b=a.bindable,c=a.inject},function(a){},function(a){d=a.HttpClient},function(a){e=a["default"]},function(a){f=a["default"]},function(a){g=a.EventAggregator}],execute:function(){h=function(){function a(a,b,c){babelHelpers.classCallCheck(this,i),babelHelpers.defineDecoratedPropertyDescriptor(this,"item",h),babelHelpers.defineDecoratedPropertyDescriptor(this,"index",h),this.element=a,this.http=b,this.ea=c}var h={},h={};babelHelpers.createDecoratedClass(a,[{key:"item",decorators:[b],initializer:null,enumerable:!0},{key:"index",decorators:[b],initializer:null,enumerable:!0}],null,h),babelHelpers.createDecoratedClass(a,[{key:"setUpMarker",value:function(){if(this.miniMap&&this.item){this.item.pos||(this.item.pos=[0,0]);var a=new L.MarkerClusterGroup;self.map.setView(this.item.pos,13);var b=L.marker(new L.LatLng(this.item.pos[0],this.item.pos[1]),{icon:L.mapbox.marker.icon({"marker-symbol":this.item.marker,"marker-color":this.item.color})});a.addLayer(b),self.map.addLayer(a)}}},{key:"setUpContent",value:function(){var a=this,b=new f({html:!0});this.http.fetch("data/thumbs/"+this.item.data+".md").then(function(a){return a.text()}).then(function(c){var d=b.render(c);d=e.adjustMedia(d),a.data=d})}},{key:"itemChanged",value:function(){this.setUpMarker()}},{key:"attached",value:function(){self.map=L.mapbox.map("mini-map-"+this.index,"mapbox.streets",{zoomControl:!1,infoControl:!1}).setView(this.item.pos,16),self.map.dragging.disable(),self.map.touchZoom.disable(),self.map.doubleClickZoom.disable(),self.map.scrollWheelZoom.disable(),self.map.keyboard.disable(),self.map.tap&&self.map.tap.disable(),this.setUpMarker(),this.setUpContent()}},{key:"editMarker",value:function(){this.ea.publish("admin-marker-edit",this.item)}}],null,h);var i=a;return a=c(Element,d,g)(a)||a}(),a("AdminMarkerInfo",h)}}}),function(){var a=System.amdDefine;a("elements/closeInfo.html!github:systemjs/plugin-text@0.0.4.js",[],function(){return'<template> <div> <div class="close-info"> <span if.bind="showDistance" class="label label-default"><i class="fa fa-map-marker"></i>&nbsp;${data.distance | toDistanceView}</span> <div if.bind="html" innerHTML.bind="html"> </div> <div if.bind="!html" class="spinner yellow"> <div class="rect1"></div> <div class="rect2"></div> <div class="rect3"></div> <div class="rect4"></div> <div class="rect5"></div> </div> <div class="text-right"> <a href="#/${data.data}" class="btn btn-default" t="map.marker.readMore"></a> </div> </div> <hr> </div> </template>'})}(),System.register("elements/mediaAdjuster.js",[],function(a){"use strict";var b;return{setters:[],execute:function(){b=function(){function a(){babelHelpers.classCallCheck(this,a)}return babelHelpers.createClass(a,[{key:"adjustMedia",value:function(a){var b=$("<div>"+a+"</div>");return b.find("img").addClass("img-responsive img-thumbnail"),b.find("iframe").addClass("embed-responsive-item iframe-thumbnail"),b.find("iframe").wrap('<div class="embed-responsive embed-responsive-16by9"></div>'),b.html()}}]),a}(),a("default",new b)}}}),System.register("elements/closeInfo.js",["fetch","aurelia-fetch-client","aurelia-framework","../elements/mediaAdjuster","aurelia-i18n","remarkable"],function(a){"use strict";var b,c,d,e,f,g,h,i;return{setters:[function(a){},function(a){b=a.HttpClient},function(a){c=a.inject,d=a.bindable},function(a){e=a["default"]},function(a){f=a.I18N},function(a){g=a["default"]}],execute:function(){h=function(){function a(a,b){babelHelpers.classCallCheck(this,h),babelHelpers.defineDecoratedPropertyDescriptor(this,"data",f),babelHelpers.defineDecoratedPropertyDescriptor(this,"showDistance",f),this.http=a,this.md=new g({html:!0}),this.element=b,this.showDistance=!0,this.html=""}var f={},f={};babelHelpers.createDecoratedClass(a,[{key:"data",decorators:[d],initializer:null,enumerable:!0},{key:"showDistance",decorators:[d],initializer:null,enumerable:!0}],null,f),babelHelpers.createDecoratedClass(a,[{key:"bind",value:function(){var a=this;return this.http.fetch("data/thumbs/"+this.data.data+".md").then(function(a){return a.text()}).then(function(b){var c=a.md.render(b);c=e.adjustMedia(c),a.html=c})}}],null,f);var h=a;return a=c(b,Element)(a)||a}(),a("CloseInfo",h),i=function(){function a(a){babelHelpers.classCallCheck(this,b),this.i18n=a}babelHelpers.createClass(a,[{key:"toView",value:function(a){var b=parseInt(a),c=b>1e3?(b/1e3).toFixed(1):a,d=b>1e3?this.i18n.i18next.t("closeInfo.kilometers"):this.i18n.i18next.t("closeInfo.meters");return c+" "+d}}]);var b=a;return a=c(f)(a)||a}(),a("ToDistanceViewValueConverter",i)}}}),function(){var a=System.amdDefine;a("elements/footer.html!github:systemjs/plugin-text@0.0.4.js",[],function(){return'<template> <div class="footer"> <div class="container"> <div style="float:right"> <span>&copy;&nbsp;Дмитрий Карпов | Тюмень | Altal Oy | Finland |</span>&nbsp;<span click.delegate="signIn()"><i class="fa fa-child"></i></span> <span if.bind="user.isLoggedIn"> | <a href="JavaScript:void(0);" t="admin.signOut" click.delegate="signOut()"></a></span> </div> </div> </div> </template>'})}(),System.register("elements/userInfo.js",[],function(a){"use strict";var b;return{setters:[],execute:function(){b=function(){function a(){babelHelpers.classCallCheck(this,a),this.id=""}return babelHelpers.createClass(a,[{key:"clear",value:function(){this.id=""}},{key:"isLoggedIn",get:function(){return""!=this.id}}]),a}(),a("UserInfo",b)}}}),System.register("elements/footer.js",["./userInfo","aurelia-framework","aurelia-router","lodash"],function(a){"use strict";var b,c,d,e,f;return{setters:[function(a){b=a.UserInfo},function(a){c=a.inject},function(a){d=a.Router},function(a){e=a["default"]}],execute:function(){f=function(){function a(a,b){babelHelpers.classCallCheck(this,e),this.user=a,this.router=b,this.admins=["206209973","30248483"]}babelHelpers.createClass(a,[{key:"attached",value:function(){var a=this;VK.Auth.getLoginStatus(function(b){a.onLogin(b)})}},{key:"signIn",value:function(){var a=this;this.user.isLoggedIn?this.router.navigate("adm"):VK.Auth.login(function(b){a.onLogin(b,!0)})}},{key:"signOut",value:function(){var a=this;VK.Auth.logout(function(b){a.onLogout(b)})}},{key:"onLogout",value:function(a){this.user.clear(),"/adm"==this.router.currentInstruction.fragment&&this.router.navigate("")}},{key:"onLogin",value:function(a,b){if(a.session){if(-1==this.admins.indexOf(a.session.mid))return void this.onLogout();this.user.id=a.session.mid,b&&this.router.navigate("adm")}else console.log(this.user.id),this.user.clear()}}]);var e=a;return a=c(b,d)(a)||a}(),a("Footer",f)}}}),function(){var a=System.amdDefine;a("elements/markerEditModal.html!github:systemjs/plugin-text@0.0.4.js",[],function(){return'<template> <div class="modal fade" ref="modal" tabindex="-1" role="dialog"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title" t="admin.edit.title"></h4> </div> <div class="modal-body"> <div class="row"> <div class="col-md-4"> <label t="admin.edit.color" for="colorEdit"></label> <input type="color" id="colorEdit" value.bind="item.color" class="form-control" css="color: ${item.color};"> </div> <div class="col-md-4"> <label t="admin.edit.coordinatesLat" for="coordinatesEditLat"></label> <input id="coordinatesEditLat" value.two-way="item.pos | pos:0:item.pos" class="form-control"> </div> <div class="col-md-4"> <label t="admin.edit.coordinatesLon" for="coordinatesEditLon"></label> <input id="coordinatesEditLon" value.two-way="item.pos | pos:1:item.pos" class="form-control"> </div> <div class="col-md-12" css="position: relative; margin-top: 1em; margin-bottom: 1em;"> <div class="mini-map-modal" id="mini-map-modal" ref="miniMap"></div> </div> <div class="col-md-6"> <label t="admin.edit.image" for="imageMarker"></label> <a t="admin.edit.images" href="https://www.mapbox.com/maki-icons/" target="blank"></a> <input id="imageMarker" change.bind="markerChanged()" value.two-way="item.marker & updateTrigger:\'blur\'" class="form-control"> </div> <div class="col-md-6"> <label t="admin.edit.data" for="markerData"></label> <input id="markerData" value.two-way="item.data" class="form-control"> </div> <div class="col-md-6" style="margin-top:1em"> <label t="admin.edit.thumb" for="thumb"></label> <input type="file" name="thumbFile" id="thumb" accept=".md" files.bind="thumbFile" class="form-control"> </div> <div class="col-md-6" style="margin-top:1em"> <label t="admin.edit.full" for="full"></label> <input type="file" name="fullFile" id="full" accept=".md" files.bind="fullFile" class="form-control"> </div> </div> </div> <div class="modal-footer"> <button type="button" class="btn danger float btn-link" data-dismiss="modal" click.delegate="delete()"><i class="fa fa-trash-o"></i></button> <button type="button" class="btn btn-default" data-dismiss="modal" t="admin.edit.cancel"></button> <button type="button" class="btn btn-primary" data-dismiss="modal" t="admin.edit.apply" click.delegate="save()"></button> </div> </div> </div> </div> </template>'})}(),System.register("elements/markerEditModal.js",["jquery","aurelia-framework","aurelia-event-aggregator","fetch","aurelia-fetch-client"],function(a){"use strict";var b,c,d,e,f,g,h,i;return{setters:[function(a){b=a["default"]},function(a){c=a.bindable,d=a.inject,e=a.BindingEngine},function(a){f=a.EventAggregator},function(a){},function(a){g=a.HttpClient}],execute:function(){h=function(){function a(a,b,c){babelHelpers.classCallCheck(this,i),babelHelpers.defineDecoratedPropertyDescriptor(this,"item",h),this.mo=b,this.ea=a,this.http=c,this.thumbFile,this.fullFile}var h={},h={};babelHelpers.createDecoratedClass(a,[{key:"item",decorators:[c],initializer:null,enumerable:!0}],null,h),babelHelpers.createDecoratedClass(a,[{key:"setUpMarker",value:function(){if(this.miniMap&&this.item){if(!this.item.pos)return void(this.item.pos=[0,0]);var a=[this.item.pos[0],this.item.pos[1]];this.markers&&this.map.removeLayer(this.markers),this.markers=new L.MarkerClusterGroup,this.map.setView(a,13);var b=L.marker(new L.LatLng(this.item.pos[0],this.item.pos[1]),{icon:L.mapbox.marker.icon({"marker-symbol":this.item.marker,"marker-color":this.item.color})});this.markers.addLayer(b),this.map.addLayer(this.markers)}}},{key:"initializeMap",value:function(){this.map||(this.map=L.mapbox.map("mini-map-modal","mapbox.streets",{zoomControl:!1,infoControl:!1}))}},{key:"itemChanged",value:function(){var a=this;this.colorDispose&&this.colorDispose.dispose(),this.markerDispose&&this.markerDispose.dispose(),this.item&&(this.colorDispose=this.mo.propertyObserver(this.item,"color").subscribe(function(){a.setUpMarker()}),this.markerDispose=this.mo.propertyObserver(this.item,"marker").subscribe(function(){a.setUpMarker()}))}},{key:"attached",value:function(){var a=this;this.initializeMap();var c=this;b(this.modal).on("shown.bs.modal",function(){c.invalidateMap(),c.setUpMarker()}),this.posChangedSub=this.ea.subscribe("marker-model-changed",function(){a.setUpMarker()})}},{key:"detached",value:function(){this.posChangedSub.dispose()}},{key:"invalidateMap",value:function(){this.map.invalidateSize()}},{key:"uploadFile",value:function(a,b){if(!b)return null;var c=new FormData;return c.append(a+this.item.data,b[0]),c.append("dir",a),c.append("fileNameParam",a+this.item.data),c.append("targetFileName",this.item.data+".md"),this.http.fetch("upload.php",{method:"POST",body:c})}},{key:"save",value:function(){var a=this,b=this.uploadFile("thumbs",this.thumbFile),c=this.uploadFile("full",this.fullFile);Promise.all([b,c]).then(function(){a.ea.publish("admin-marker-saved",a.item)})}},{key:"delete",value:function(){this.ea.publish("admin-marker-delete",this.item)}}],null,h);var i=a;return a=d(f,e,g)(a)||a}(),a("MarkerEditModal",h),i=function(){function a(a){babelHelpers.classCallCheck(this,b),this.ea=a}babelHelpers.createClass(a,[{key:"toView",value:function(a,b){return this.index=b,a?a[b]:void 0}},{key:"fromView",value:function(a,b,c){return c[b]=parseFloat(a),this.ea.publish("marker-model-changed"),c}}]);var b=a;return a=d(f)(a)||a}(),a("PosValueConverter",i)}}}),System.register("elements/multiObserver.js",["aurelia-framework"],function(a){"use strict";var b,c;return{setters:[function(a){b=a.ObserverLocator}],execute:function(){c=function(){function a(b){babelHelpers.classCallCheck(this,a),this.observerLocator=b}return babelHelpers.createClass(a,null,[{key:"inject",value:function(){return[b]}}]),babelHelpers.createClass(a,[{key:"observe",value:function(a,b){for(var c,d,e=[],f=a.length;f--;){c=a[f][0],d=a[f][1];var g=this.observerLocator.getObserver(c,d).subscribe(b);e.push(g)}return function(){for(;e.length;){e.pop()}}}}]),a}(),a("MultiObserver",c)}}}),function(){var a=System.amdDefine;a("elements/navBar.html!github:systemjs/plugin-text@0.0.4.js",[],function(){return'<template> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle Navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="#"> <img alt="Brand" src="./content/logo2.png" class="logo"> </a> </div> <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"> <ul class="nav navbar-nav"> <li repeat.for="row of router.navigation" class="${row.isActive ? \'active\' : \'\'}"> <a href.bind="row.href" if.bind="row.settings.target==undefined">${row.title}</a> <a href.bind="row.href" target.bind="row.settings.target" if.bind="row.settings.target!=undefined">${row.title}</a> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li class="loader" if.bind="router.isNavigating"> <i class="fa fa-spinner fa-spin fa-2x"></i> </li> </ul> </div> </nav> </template>'})}(),System.register("elements/navBar.js",["aurelia-framework"],function(a){"use strict";var b,c;return{setters:[function(a){b=a.bindable}],execute:function(){c=function(){function a(){babelHelpers.classCallCheck(this,a),babelHelpers.defineDecoratedPropertyDescriptor(this,"router",c)}var c={};return babelHelpers.createDecoratedClass(a,[{key:"router",decorators:[b],initializer:null,enumerable:!0}],null,c),a}(),a("NavBar",c)}}}),function(){var a=System.amdDefine;a("elements/wall.html!github:systemjs/plugin-text@0.0.4.js",[],function(){return'<template> <require from="../elements/closeInfo"></require> <div class="wall-container" id="wall-container"> <div class="wall-item" repeat.for="i of infos"> <div class="section"> <close-info show-distance.bind="showDistance" class="info-tile" data.bind="i"></close-info> </div> </div> </div> </template>'})}(),System.register("elements/wall.js",["aurelia-framework","aurelia-event-aggregator"],function(a){"use strict";var b,c,d,e;return{setters:[function(a){b=a.bindable,c=a.inject},function(a){d=a.EventAggregator}],execute:function(){e=function(){function a(a,b){babelHelpers.classCallCheck(this,f),babelHelpers.defineDecoratedPropertyDescriptor(this,"infos",e),babelHelpers.defineDecoratedPropertyDescriptor(this,"showDistance",e),this.element=a,this.showDistance=!0}var e={};babelHelpers.createDecoratedClass(a,[{key:"infos",decorators:[b],initializer:null,enumerable:!0},{key:"showDistance",decorators:[b],initializer:null,enumerable:!0}],null,e);var f=a;return a=c(Element,d)(a)||a}(),a("Wall",e)}}});